name: 同步链接到 Cloudflare KV

on:
  workflow_dispatch:  # 仅保留手动触发（GitHub 界面「Run workflow」按钮）

jobs:
  sync-to-kv:
    runs-on: ubuntu-latest  # 使用 Ubuntu 环境（GitHub Actions 常用）
    steps:
      - name: 检出代码
        uses: actions/checkout@v4  # 检出当前仓库代码

      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"  # 指定 Python 版本（与本地兼容即可）

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests  # 安装脚本依赖的 requests 库

      - name: 运行 KV 同步脚本
        env:
          # 从 GitHub Secrets 注入环境变量（需提前在仓库 Settings > Secrets 中配置）
          CF_EMAIL: ${{ secrets.CF_EMAIL }}
          CF_API_KEY: ${{ secrets.CF_API_KEY }}
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_KV_NAMESPACE_ID: ${{ secrets.CF_KV_NAMESPACE_ID }}
          CF_KV_KEY: "LINK.txt"  # 可选，若需修改键名可调整
        run: python KV.PY  # 注意路径与仓库结构匹配（若脚本在根目录则改为 python KV.py）
